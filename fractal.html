<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sierpinski 分形三角形</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      background-color: #f0f0f0; /* 与主页一致的背景色 */
      box-sizing: border-box;
    }

    h1 {
      margin-bottom: 20px;
      color: #333;
      font-size: 1.5em; /* 调整标题字体大小 */
    }

    .game-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      max-width: 500px; /* 最大宽度限制 */
      margin: 0 auto;
    }

    svg {
      width: 100%; /* 宽度自适应 */
      height: auto; /* 高度自动调整 */
      border: 2px solid #AFC2CB; /* 与Flip the Nine的玩家1色系保持一致 */
      background-color: #fff;
      border-radius: 10px;
    }

    .info {
      margin-top: 20px;
      font-size: 1em; /* 调整信息字体大小 */
      font-weight: bold;
      color: #333;
    }

    .version {
      margin-top: 30px;
      font-size: 0.8em; /* 调整版本信息字体大小 */
      color: #666;
    }

    .controls {
      margin-top: 20px;
    }

    .button {
      padding: 10px 15px;
      font-size: 1em;
      background: #ccc;
      border-radius: 5px;
      text-decoration: none;
      color: #000;
      margin: 5px;
      cursor: pointer;
      border: none;
      transition: background 0.3s;
    }

    .button:hover {
      background: #bbb;
    }

    /* 高亮三角形内部 */
    #highlightTriangle {
      fill: rgba(255, 165, 0, 0.3); /* 橙色高亮 */
      visibility: hidden;
    }

    /* 顶点样式 */
    .vertex {
      fill: #0000FF; /* 蓝色表示顶点 */
      cursor: pointer;
      transform-box: fill-box;
      transform-origin: center;
      transition: transform 0.2s, fill 0.2s;
    }

    .vertex.hovered {
      fill: #1E90FF; /* 悬停时更亮的蓝色 */
      transform: scale(1.5); /* 放大效果 */
    }

    /* 响应式调整 */
    @media (max-width: 600px) {
      h1 {
        font-size: 1.2em;
      }
      .info {
        font-size: 0.9em;
      }
      .version {
        font-size: 0.7em;
      }
    }
  </style>
</head>
<body>

  <h1>Sierpinski 分形三角形</h1>

  <div class="game-container">
    <svg id="triangleSvg" viewBox="0 0 500 500" preserveAspectRatio="xMidYMid meet">
      <!-- 高亮区域 -->
      <polygon id="highlightTriangle" points="" />
      <!-- 主三角形 -->
      <polygon id="triangle" points="" fill="#AFC2CB" stroke="#333" stroke-width="2"/>
      <!-- 顶点 -->
      <circle id="vertex0" class="vertex" cx="" cy="" r="10" visibility="hidden" />
      <circle id="vertex1" class="vertex" cx="" cy="" r="10" visibility="hidden" />
      <circle id="vertex2" class="vertex" cx="" cy="" r="10" visibility="hidden" />
      <!-- 点集合 -->
      <g id="pointsGroup"></g>
      <!-- 预览连线 -->
      <line id="previewLine" stroke="#FF0000" stroke-width="2" visibility="hidden"/>
    </svg>
  </div>

  <div class="info" id="infoText">在三角形内点击选择一个初始点</div>

  <div class="controls">
    <button class="button" id="resetBtn">重置游戏</button>
    <a href="index.html" class="button">返回主页</a>
  </div>

  <p class="version">Version: 1.1</p>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const svg = document.getElementById("triangleSvg");
      const triangle = document.getElementById("triangle");
      const highlightTriangle = document.getElementById("highlightTriangle");
      const pointsGroup = document.getElementById("pointsGroup");
      const previewLine = document.getElementById("previewLine");
      const infoText = document.getElementById("infoText");
      const resetBtn = document.getElementById("resetBtn");
      const verticesElements = [
        document.getElementById("vertex0"),
        document.getElementById("vertex1"),
        document.getElementById("vertex2")
      ];

      const width = 500;
      const height = 500;

      const side = 400;
      const heightOfTriangle = side * Math.sqrt(3) / 2;
      const offsetX = (width - side) / 2;
      const offsetY = (height - heightOfTriangle) / 2;

      const vertices = [
        { x: offsetX + side / 2, y: offsetY },
        { x: offsetX, y: offsetY + heightOfTriangle },
        { x: offsetX + side, y: offsetY + heightOfTriangle }
      ];

      let currentPoint = null;
      let stage = 0;

      // 初始化游戏
      function initGame() {
        pointsGroup.innerHTML = "";
        currentPoint = null;
        stage = 0;

        triangle.setAttribute("points", vertices.map(v => `${v.x},${v.y}`).join(" "));
        highlightTriangle.setAttribute("points", triangle.getAttribute("points"));

        verticesElements.forEach((vertex, i) => {
          vertex.setAttribute("cx", vertices[i].x);
          vertex.setAttribute("cy", vertices[i].y);
          vertex.setAttribute("visibility", "hidden");
        });

        highlightTriangle.style.visibility = "visible";
        infoText.textContent = "在三角形内点击选择一个初始点";
      }

      function drawPoint(point, color) {
        const newPoint = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        newPoint.setAttribute("cx", point.x);
        newPoint.setAttribute("cy", point.y);
        newPoint.setAttribute("r", 3);
        newPoint.setAttribute("fill", color);
        pointsGroup.appendChild(newPoint);
      }

      function drawLine(p1, p2) {
        previewLine.setAttribute("x1", p1.x);
        previewLine.setAttribute("y1", p1.y);
        previewLine.setAttribute("x2", p2.x);
        previewLine.setAttribute("y2", p2.y);
        previewLine.setAttribute("visibility", "visible");
        setTimeout(() => previewLine.setAttribute("visibility", "hidden"), 500);
      }

      function calculateMidpoint(p1, p2) {
        return {
          x: (p1.x + p2.x) / 2,
          y: (p1.y + p2.y) / 2
        };
      }

      svg.addEventListener("click", (e) => {
        const rect = svg.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (width / rect.width);
        const y = (e.clientY - rect.top) * (height / rect.height);

        if (stage === 0) {
          if (!isPointInTriangle({ x, y }, vertices[0], vertices[1], vertices[2])) return;

          currentPoint = { x, y };
          drawPoint(currentPoint, "red");
          highlightTriangle.style.visibility = "hidden";
          verticesElements.forEach(v => v.setAttribute("visibility", "visible"));
          infoText.textContent = "点击选择一个顶点";
          stage = 1;
        } else if (stage === 1) {
          const clickedVertexIndex = vertices.findIndex(
            (v) => Math.hypot(v.x - x, v.y - y) < 10
          );
          if (clickedVertexIndex !== -1) {
            const selectedVertex = vertices[clickedVertexIndex];
            drawLine(currentPoint, selectedVertex);

            const midPoint = calculateMidpoint(currentPoint, selectedVertex);
            drawPoint(midPoint, "red");
            currentPoint = midPoint;
          }
        }
      });

      function isPointInTriangle(p, p0, p1, p2) {
        const area = 0.5 * (-p1.y * p2.x + p0.y * (-p1.x + p2.x) + p0.x * (p1.y - p2.y) + p1.x * p2.y);
        const s = (1 / (2 * area)) * (p0.y * p2.x - p0.x * p2.y + (p2.y - p0.y) * p.x + (p0.x - p2.x) * p.y);
        const t = (1 / (2 * area)) * (p0.x * p1.y - p0.y * p1.x + (p0.y - p1.y) * p.x + (p1.x - p0.x) * p.y);
        return s > 0 && t > 0 && (s + t) < 1;
      }

      verticesElements.forEach(vertex => {
        vertex.addEventListener("pointerenter", (e) => e.target.classList.add("hovered"));
        vertex.addEventListener("pointerleave", (e) => e.target.classList.remove("hovered"));
      });

      resetBtn.addEventListener("click", initGame);

      initGame();
    });
  </script>

</body>
</html>